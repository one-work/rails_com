<%= form_with theme: nil, method: :get, id: 'filter_search_form', data: { controller: 'search-input' }, class: 'weui-search-bar' do |f| %>
  <% unless params.key?('name-like') %>
  <div class="field-body">
    <div class="control has-icons-right">
      <%= f.search_field 'name-like', value: params['name-like'], class: 'input', placeholder: '搜索', autocomplete: 'off', data: { search_input_target: 'input', action: 'change->search-input#cancel' } %>
      <%= svg_tag 'magnifying-glass', class: 'icon is-small is-right p-2' %>
    </div>
    <%= f.submit 'Search', name: nil, data: { action: 'form#filter' }, class: 'button ml-2' %>
  </div>
  <% end %>
<% end %>

<div class="<%= raw_filter_params.present? ? 'tags' : 'tags display-none' %>">
  <% raw_filter_params.each do |key, value| %>
    <div id="filter_container_<%= key %>" data-controller="popup" class="max-fullwidth size-0">
      <% if record_class.columns_hash.key?(key) && record_class.columns_hash[key].type == :boolean %>
        <%= render partial: 'filter_form/filter_extend_boolean', locals: { record_class: record_class, key: key, value: value, scope: nil, form: 'filter_search_form' } %>
      <% elsif record_class.columns_hash.key?(key) && record_class.columns_hash[key].type == :datetime %>
        <%= render partial: 'filter_form/filter_extend_datetime', locals: { record_class: record_class, key: key, value: value, scope: nil, form: 'filter_search_form' } %>
      <% else %>
        <%= render partial: 'filter_form/filter_extend_text', locals: { record_class: record_class, key: key, value: value, scope: nil, form: 'filter_search_form' } %>
      <% end %>
      <%= link_to({ **request.GET.except(key) }, class: 'tag is-primary as-attached-right') do %>
        <i class="delete"></i>
      <% end %>
    </div>
  <% end %>
  <div id="filter_container" data-controller="popup" class="ml-2">
    <%= button_to({ action: 'filter' }, params: { record_class: record_class, keys: request.GET.keys }, class: 'button') do %>
      <span class="icon">
        <%= svg_tag 'plus' %>
      </span>
    <% end %>
  </div>
</div>
